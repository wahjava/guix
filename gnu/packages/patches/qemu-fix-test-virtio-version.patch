Upstream-status: Sent to qemu-devel@nongnu.org
Message-ID: <20250831125255.7066-1-maxim@guixotic.coop>

There were some discussion in <https://gitlab.com/qemu-project/qemu/-/issues/1626>.

diff --git a/tests/functional/test_virtio_version.py b/tests/functional/test_virtio_version.py
index a5ea73237f..501545f655 100755
--- a/tests/functional/test_virtio_version.py
+++ b/tests/functional/test_virtio_version.py
@@ -10,6 +10,8 @@
 # This work is licensed under the terms of the GNU GPL, version 2 or
 # later.  See the COPYING file in the top-level directory.
 
+import os
+
 from qemu.machine import QEMUMachine
 from qemu_test import QemuSystemTest
 
@@ -68,7 +70,9 @@ def run_device(self, devtype, opts=None, machine='pc'):
         """
         Run QEMU with `-device DEVTYPE`, return device info from `query-pci`
         """
-        with QEMUMachine(self.qemu_bin) as vm:
+        with QEMUMachine(
+                self.qemu_bin,
+                base_temp_dir=os.environ.get('TMPDIR', '/var/tmp')) as vm:
             vm.set_machine(machine)
             if opts:
                 devtype += ',' + opts
